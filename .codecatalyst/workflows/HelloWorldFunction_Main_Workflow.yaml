Name: HelloWorldFunction_MainWorkflow
Compute:
  Type: EC2
  Fleet: Linux.x86-64.Large
  SharedInstance: true
SchemaVersion: "1.0"

# Optional - Set automatic triggers.
Triggers:
  - Type: Push
    Branches:
      - main

# Required - Define action configurations.
Actions:
  DeployAndTest:
    Actions:
      Deploy:
        Inputs:
         Sources:
          - WorkflowSource
        Identifier: aws/github-actions-runner@v1.0.0
        Configuration:
          Steps:
            - name: Deploy to Azure Functions
              uses: serverless/github-action@v3.2
              with:
                args: -c "serverless plugin install --name serverless-azure-functions && serverless deploy"
                entrypoint: /bin/sh
              env: 
                AZURE_SUBSCRIPTION_ID: ${Secrets.SUBSCRIPTION_ID}
                AZURE_TENANT_ID: ${Secrets.TENANT_ID}
                AZURE_CLIENT_ID: ${Secrets.CLIENT_ID}
                AZURE_CLIENT_SECRET: ${Secrets.CLIENT_SECRET}    
            - name: Retrieve Deployment Details
              uses: serverless/github-action@v3.2
              with:
                args: info
              env: 
                AZURE_SUBSCRIPTION_ID: ${Secrets.SUBSCRIPTION_ID}
                AZURE_TENANT_ID: ${Secrets.TENANT_ID}
                AZURE_CLIENT_ID: ${Secrets.CLIENT_ID}
                AZURE_CLIENT_SECRET: ${Secrets.CLIENT_SECRET}  

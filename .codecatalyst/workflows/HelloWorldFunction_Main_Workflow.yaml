Name: HelloWorldFunction_MainWorkflow
Compute:
  Type: EC2
  Fleet: Linux.x86-64.Large
  SharedInstance: true
SchemaVersion: "1.0"

# Optional - Set automatic triggers.
Triggers:
  - Type: Push
    Branches:
      - main

# Required - Define action configurations.
Actions:
  DeployToAzure:
    Actions:
      Login:
        Identifier: aws/github-actions-runner@v1.0.0
        Configuration:
          Steps:
            - name: Install Azure CLI
              run: |
                rpm --import https://packages.microsoft.com/keys/microsoft.asc
                sh -c 'echo -e "[azure-cli]
                name=Azure CLI
                baseurl=https://packages.microsoft.com/yumrepos/azure-cli
                enabled=1
                gpgcheck=1
                gpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /etc/yum.repos.d/azure-cli.repo'
                yum install azure-cli -y
            - name: Login To Azure
              id: login-to-azure
              uses: azure/login@v1
              with:
                creds: ${Secrets.AZURE_CREDENTIALS}
            - name: Deploy to Azure Functions
              uses: serverless/github-action@v3.2
              with:
                args: -c "serverless plugin install --name serverless-azure-functions && serverless deploy"
                entrypoint: /bin/sh